<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>青听音乐-修改密码</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="shortcut icon" type="image/x-icon" href="images/weblogo.ico">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/register.css">
</head>

<body class="gray-bg">
    <div id="nav">
        <div class="nav">
            <ul class="n1" id="ulHeader">
                <li class="home"><a href="index.html"><img src="images/webicon.png" width="170" height="40" alt="轻语音乐" class="logo2"></a></li>

            </ul>
        </div>
    </div>
    <div id="content">
        <div class="boxb">
            <h3><span class="glyphicon glyphicon-star">&nbsp修改密码</span></h3><br /><br />
            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                            </div>
                            <div class="ibox-content">
                                <form id="updateForm" role="form" method="post" enctype="multipart/form-data">
                                    <label for="user_id">
                                        <input type="hidden" class="form-control" id="user_id" name="userId" hidden="hidden" />
                                    </label>
                                    <div class="form-group">
                                        <!-- 表单 -->
                                        <label class="col-sm-2 control-label">用户名:</label>
                                        <div class="col-sm-10" style="margin: 0 0 20px">
                                            <input type="text" class="form-control" id="user_name" name="userName"
                                                   placeholder="请输入新用户名" size="20"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">密码:</label>
                                        <div class="col-sm-10" style="margin: 0 0 20px">
                                            <input type="password" class="form-control" id="user_password"
                                                   name="userPassword" placeholder="请输入新密码" size="20"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">头像:</label>
                                        <div class="col-sm-10" style="margin: 0 0 20px">
                                            <input type="file" class="form-control" id="user_avatar" name="userAvatar"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-offset-1 col-sm-10">
                                            <button id="submitUpdate" class="btn btn-primary btn-lg">确认修改</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="js/jquery.min.js?v=2.1.4"></script>
    <script src="js/bootstrap-paginator.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/tools.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script type="text/javascript">
        /**************************注册*******************/
        $('#submitUpdate').click(function () {

            let name =$("#user_name").val().trim();
            let password = $("#user_password").val().trim();
            let avatar = $("#user_avatar").val();

            if (name===""||password===""||avatar==="") {
                alert("信息未填完整，请完善信息！");
                return;
            }

            // 设置user_id的值，使能够更新
            $("#user_id").val($.cookie("user_id"));

            $.ajax({
                url: "user/addOrEditUser",
                type: "post",
                data: new FormData($('#updateForm')[0]),
                success: function (data) {
                    if (data.statusCode === 200) {
                        $.cookie("user_name", data.data.user_name, {expires: 7, path: "/"});
                        $.cookie("user_id", data.data.user_id, {expires: 7, path: "/"});
                        $.cookie("user_avatar", data.data.user_avatar, {expires: 7, path: "/"});
                        window.location.href = "/index.html";
                        alert("修改成功，点击跳转主页");
                    } else {
                        alert(data.statusMsg);
                    }
                },
                error: function (data) {
                    alert("系统错误，请联系管理员");
                }
            })
        });

    </script>
    <div class="footer">
        <div class="links">
        </div>
        <div class="copyright">
        </div>
    </div>
</body>

</html>